[PrefixDeclaration]
mt:		http://www.semanticweb.org/ontologies/2018/4/mimic/temporal/
ms:      http://www.semanticweb.org/ontologies/2018/4/mimic/
icd:		http://purl.bioontology.org/ontology/ICD9CM/
owl:		http://www.w3.org/2002/07/owl#
rdf:		http://www.w3.org/1999/02/22-rdf-syntax-ns#
xml:		http://www.w3.org/XML/1998/namespace
xsd:		http://www.w3.org/2001/XMLSchema#
obda:		https://w3id.org/obda/vocabulary#
rdfs:		http://www.w3.org/2000/01/rdf-schema#
onprom:		http://kaos.inf.unibz.it/onprom/

[MappingDeclaration] @collection [[
mappingId	urn:Map-bodytemp
target		ms:Patient/{subject_id} mt:hasBodyTemp {v}.
interval    {temp_begin_inc} {temp_begin}^^xsd:dateTimeStamp, {temp_end}^^xsd:dateTimeStamp {temp_end_inc}
source		SELECT "charteventscopy"."subject_id",
            CASE WHEN "charteventscopy"."itemid" IN (223762, 676, 677) THEN "charteventscopy"."valuenum"
            WHEN "charteventscopy"."itemid" IN (223761, 678, 679) THEN ("charteventscopy"."valuenum" - 32) * 5 / 9 END AS "v",
            CAST('TRUE' AS Boolean) AS "temp_begin_inc", "charteventscopy"."charttime" AS "temp_begin",
            LEAD("charteventscopy"."charttime",1) OVER(PARTITION BY "charteventscopy"."subject_id" ORDER BY "charteventscopy"."charttime") AS "temp_end",
            CAST('TRUE' AS Boolean) AS "temp_end_inc" FROM "public"."charteventscopy"
            WHERE "charteventscopy"."valuenum" is NOT NULL AND "charteventscopy"."itemid" IN (676, 677, 678, 679, 223761 , 223762)

mappingId	urn:Map-icustay
target		ms:Patient/{subject_id} a mt:ICUStay.
interval    {icu_begin_inc} {icu_begin}^^xsd:dateTimeStamp, {icu_end}^^xsd:dateTimeStamp {icu_end_inc}
source		SELECT "icustays"."subject_id", CAST('TRUE' AS Boolean) AS "icu_begin_inc", "icustays"."intime" AS "icu_begin", "icustays"."outtime" AS "icu_end", CAST('TRUE' AS Boolean) AS "icu_end_inc" FROM "public"."icustays"

mappingId	urn:Map-admittedToICU
target		ms:Patient/{subject_id} a mt:AdmittedToICU.
interval    {icu_begin_inc} {icu_begin}^^xsd:dateTimeStamp, {icu_end}^^xsd:dateTimeStamp {icu_end_inc}
source		SELECT "icustays"."subject_id", CAST('TRUE' AS Boolean) AS "icu_begin_inc", "icustays"."intime" AS "icu_begin", "icustays"."intime" AS "icu_end", CAST('TRUE' AS Boolean) AS "icu_end_inc" FROM "public"."icustays"

mappingId   urn:Map-CreatinineLevel
target      ms:Patient/{subject_id} mt:hasCreatinineLevel {v}.
interval    {lab_begin_inc} {lab_begin}^^xsd:dateTimeStamp, {lab_end}^^xsd:dateTimeStamp {lab_end_inc}
source      SELECT "labevents"."subject_id", "labevents"."valuenum" AS "v",
            CAST('TRUE' AS Boolean) AS "lab_begin_inc", "labevents"."charttime" AS "lab_begin",
            "labevents"."charttime" AS "lab_end", CAST('TRUE' AS Boolean) AS "lab_end_inc"
            FROM "public"."labevents" WHERE "labevents"."valuenum" IS NOT NULL LIMIT 10010

mappingId   urn:Map-Arterial-line
target      ms:Patient/{subject_id} a mt:ArterialLineCatheterDressed.
interval    {c_begin_inc} {c_begin}^^xsd:dateTimeStamp, {c_end}^^xsd:dateTimeStamp {c_end_inc}
source      select "subject_id", CAST('TRUE' AS Boolean) AS "c_begin_inc", "c_begin", "c_end", CAST('FALSE' AS Boolean) AS "c_end_inc"
                                   from (
                                       select "subject_id",
                                       LAG("charttime", 1) OVER (partition by "icustay_id" order by "charttime") as "c_begin",
                                       "charttime" AS "c_end"
                                       FROM (
                                           select "subject_id", "icustay_id", "charttime"
                                           FROM (
                                               select "charteventscopy"."subject_id", "charteventscopy"."icustay_id", "charteventscopy"."charttime"
                                               , max(case when "charteventscopy"."itemid" =  229  then "charteventscopy"."value" else null end) as INV1_Type
                                               , max(case when "charteventscopy"."itemid" =  8392 then "charteventscopy"."value" else null end) as INV1_Site
                                               , max(case when "charteventscopy"."itemid" =  235  then "charteventscopy"."value" else null end) as INV2_Type
                                               , max(case when "charteventscopy"."itemid" =  8393 then "charteventscopy"."value" else null end) as INV2_Site
                                               , max(case when "charteventscopy"."itemid" =  241  then "charteventscopy"."value" else null end) as INV3_Type
                                               , max(case when "charteventscopy"."itemid" =  8394 then "charteventscopy"."value" else null end) as INV3_Site
                                               , max(case when "charteventscopy"."itemid" =  247  then "charteventscopy"."value" else null end) as INV4_Type
                                               , max(case when "charteventscopy"."itemid" =  8395 then "charteventscopy"."value" else null end) as INV4_Site
                                               , max(case when "charteventscopy"."itemid" =  253  then "charteventscopy"."value" else null end) as INV5_Type
                                               , max(case when "charteventscopy"."itemid" =  8396 then "charteventscopy"."value" else null end) as INV5_Site
                                               , max(case when "charteventscopy"."itemid" =  259  then "charteventscopy"."value" else null end) as INV6_Type
                                               , max(case when "charteventscopy"."itemid" =  8397 then "charteventscopy"."value" else null end) as INV6_Site
                                               , max(case when "charteventscopy"."itemid" =  265  then "charteventscopy"."value" else null end) as INV7_Type
                                               , max(case when "charteventscopy"."itemid" =  8398 then "charteventscopy"."value" else null end) as INV7_Site
                                               , max(case when "charteventscopy"."itemid" =  271  then "charteventscopy"."value" else null end) as INV8_Type
                                               , max(case when "charteventscopy"."itemid" =  8399 then "charteventscopy"."value" else null end) as INV8_Site
                                               FROM "public"."charteventscopy"
                                               where "charteventscopy"."itemid" in
                                               (229, 235, 241, 247, 253, 259, 265, 271, 8392, 8393, 8394, 8395, 8396, 8397, 8398, 8399)
                                               and "charteventscopy"."value" is not null
                                               group by "charteventscopy"."subject_id", "charteventscopy"."icustay_id", "charteventscopy"."charttime"
                                               )SUBQ1
                                          where (inv1_type = 'A-Line') OR (inv2_type = 'A-Line') OR (inv3_type = 'A-Line') OR (inv4_type = 'A-Line') OR (inv5_type = 'A-Line')
                                            OR (inv6_type = 'A-Line') OR (inv7_type = 'A-Line') OR (inv8_type = 'A-Line')
                                        )SUBQ2
                                   )SUBQ3
                                   where "c_end" is not null and "c_end" - interval '16' hour < "c_begin"
]]